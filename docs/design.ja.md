# Kvelteの仕様とデザイン

このドキュメントでは、Kvelteの設計と実装について説明します。Kvelteの使用にのみ関心がある場合は、このドキュメントを読む必要はありません。

# 動機

Kvelteを開発することにした動機は以下です

### 既存のテンプレートエンジンの課題

FreeMarker などの Java / Kotlin で使用できるテンプレートエンジンは、現代的なWebサイトに必要なリッチなUIを使用することに適していません。
また、TypeScriptやSASSなどの、フロントエンド開発者にとっては当たり前の開発環境を手に入れることは難しいです。
現に、私が知る限り多くの会社では、バックエンドにKotlinやGoを使用し、フロントエンドに React / Vue / Svelte などを使用しています。
バックエンドとフロントエンドで別のアプリケーションを開発することは本来オーバーヘッドであるにも関わらず、現代的なリッチなUIを実現するためにこの方法が採用されています。
これは明らかに解決されるべき課題であると感じています。

### なぜSvelteを使用するのか

リッチなUIを開発するためには、 React / Vue / Svelte など、複数の選択肢があります。
私はこの中で Svelte を使用することを選択しました。
なぜなら、Svelteは仮想DOMを使用していないからです。
React / Vue といったフレームワークは、仮想DOMと呼ばれる間表現を用いてリッチなUIを実現しているため、
仮想DOMを処理するためのランタイムが必要です。これにより、多くのJavaScriptが必要です。
一方、Svelteは仮想DOMを使用していないため、少ないJavaScriptでリッチなUIを実現できます。

また、Svelteは、XHTML (HTMLのスーパーセット) です。React / Vue はそれ特有の知識が必要ですが、Svelteは相対的に少ない知識で使用できます。
([対話方式の優れたチュートリアル](https://svelte.dev/tutorial/basics) があるため、素早くキャッチアップできます)
バックエンド開発者はフロントエンド開発に精通しているとは限らないため、少ない知識でリッチなUIを実現できることは重要な観点です。

この2点の理由から、私はSvelteを選択しました。

# 基本デザイン

### フレームワーク非依存

Kvelteは、Spring Boot や Ktor などのフレームワークに依存しない、Kotlinユーザーであれば誰でも利用できるライブラリを目指します。
これは、Kvelteとフレームワークを繋ぐためにいくつかの実装が必要になる可能性がありますが、できる限りその作業を最小化することで、ユーザーの負担にならないようにします。
また、Kvelteが安定したら、各フレームワーク用のラッパーライブラリの開発も検討します。

### コンフィグレーションフリー

フロントエンドフレームワークを使用する場合、例えばSvelteの場合、 `rollup.config.js` などといった設定ファイルに設定を施す必要があります。
Svelteのユースケースによって異なる設定が必要だからです。例えば、静的なHTMLだけが欲しい場合、SSRモードでSvelteを使用する必要があります。
しかし、KotlinフレームワークからSvelteを使用する場合、このような設定はほとんどの場合同じで問題ないはずです。
加えて、Kotlinユーザーは、フロントエンドフレーワークのコンフィグレーションをするための前提知識を持っていない可能性があります。
(もしくはそのような知識を持っていないユーザーでもKvelteは使用できるようにしたいと考えています。)
よって、少なくともKvelteユーザーが増えるまでの間、コンフィグレーションフリーなライブラリとして提供します。

### 決められたディレクトリ構造

Kvelteは、ユーザーが指定したSvelteファイルをJavaScriptに変換して返却します。
例えば、以下のようなディレクトリ構造があった場合の Kotlin のコードは以下です。

```
src
 |- Foo.kt
resources
 |- lib
     |- header.svelte
     |- footer.svelte
 |- routes
     |- foo.svelte
```

```kotlin
class Foo {
  fun get() {
    val props = mapOf("prop" to "hello!")
    return Kvelte.load("foo.svelte", props)
  }
}

```

Kvelteは `routes` ディレクトリの配下に配置したSvelteファイルを認識してコンパイルします。

# 内部設計

### 開発時


### 本番ビルド

