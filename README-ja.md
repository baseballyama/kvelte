[English README is here](./README.md)

# Kvelte

KotlinユーザーがUIを構築する最速の方法

## 特徴

- 💎 リッチなUIを実現
- 💡 最小限のネットワーク通信量
- 🚀 超高性能レスポンス
- ⛏ 他のライブラリと併用可能


Kvelteは、Kotlinユーザーが、Ktor や Spring Boot などのWebアプリケーションを開発する際に、[Svelte](https://svelte.jp/) をテンプレートエンジンとして利用するためのライブラリです。
Svelteは、[State of JS 2021](https://2021.stateofjs.com/ja-JP/libraries/front-end-frameworks/) で最も多くの人が興味を持っているフロントエンドフレームワークです。
Svelteは、[公式が提供しているチュートリアル](https://svelte.dev/tutorial/basics) を学習することで、初学者でもすぐにリッチなUIを構築できる、という特徴を持っています。

Svelteは本質的にコンパイラです。`.svelte` ファイルは仮想DOMを持たない最小限のJavaScriptにコンパイルされます。また、モジュールバンドラー (Rollup) を使用することにより、未使用のJavaScriptを全て削ぎ落とした最小限のJavaScriptを生成します。これにより、最小限のネットワーク通信量でユーザーにページを配信することができます。

`Kvelte` は、コンパイルしたSvelteファイルを事前にキャッシュしておき、リクエスト時に必要最小限の処理を実行してレスポンスします。これにより、サーバーサイドの超高性能レスポンスを実現しています。
また、クライアントに配信するHTMLは、静的な部分をレンダリングしたHTMLと動的な部分を処理するJavScriptを両方含むことで、クライアント側での描画性能を最適化しています。(これを一般的にハイドレーションと呼びます)

`kvelte` は、SvelteコンポーネントをHTMLファイルとして提供するライブラリなので、他のライブラリと併用することができます。これは、一部のエンドポイントのみSvelteで構築したり、既存のWebアプリケーションを徐々にSvelteに移行することができることを意味します。

## 使用方法

WIP

## 他の選択肢との比較

### 既存テンプレートエンジン (例: Thymeleaf)

例えば Spring Boot を使用している場合、テンプレートエンジンとして、`FreeMarker` や `Thymeleaf`、`JSP` などを使用できます。
これらのライブラリは、テンプレートエンジン特有の記法を使用して最終的にレンダリングするHTMLをランタイム時に構築します.

`Thymeleaf` の例
```html
<div class="outer">
  <div th:if="${hoge}" th:text="Hello ${hoge}">Hello anonymous</div>
</div>
</html>
```

このように、サーバー側で最終的な `HTML` をクライアントに返却する方法を `SSR` と呼びます。
この方法は、クライアント側での表示は速い傾向にありますが、サーバー側で毎回HTMLを構築する必要があるため一般的に以下の問題があります。

1. レスポンスに時間がかかる
2. サーバー負荷が高くなりがち

また、テンプレートエンジンライブラリには、以下の課題があると考えています。

3. JavaScript / CSSとの親和性が悪い (JavaScriptやCSSを用いた開発体験が考慮されていない)
4. TypeScriptやPugなど、フロントエンド開発者にとって便利なツールを導入できない
5. テンプレートエンジン自体に対する学習コストが高い

`Kvelte` を使用すると、これらの問題を解決できると考えています。
1. 事前にビルドしたHTMLを返却するためレスポンスが高速
2. リクエストの度にHTMLをビルドする必要がないためサーバー負荷を抑えられる
3. Svelteが提供する開発体験により JavaScript / CSS の親和性が高い
4. TypeScriptなど、任意のAlt言語を導入できる
5. Svelteが提供するチュートリアルにより初学者でもすぐに扱うことができる

### Svelte (SPA) + Kotlin APIサーバー

SPA + API サーバーを構築することは、以下の点で開発オーバーヘッドをもたらします。

1. フロントエンドからAPIを実行する処理を記述する必要がありコード量が増える
2. SPAのリソースとAPIサーバーを別々にデプロイする必要がありインフラ管理が煩雑
3. アーキテクチャが複雑になる (責務分離 / APIエラーハンドリング / 無停止デプロイ など)

`Kvelte` を使用すると、これらの問題を解決できると考えています。
1. バックエンドからフロンエンドに渡す値は `kvelte.load` を呼び出して設定するだけ
2. Kotlinのアプリだけをデプロイすれば良いのでインフラ管理が楽
3. Svelteはテンプレートエンジンとして描画のみを担当するためアーキテクチャの考慮が不要

